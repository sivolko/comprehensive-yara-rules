/*
   YARA Rule Set
   Author: Claude
   Date: 2025-05-21
   Identifier: TrickBot Banking Trojan
   Reference: https://attack.mitre.org/software/S0266/
*/

rule malware_trickbot_main {
    meta:
        description = "Detects TrickBot banking trojan main components"
        author = "Claude"
        date = "2025-05-21"
        hash1 = "4f9dde43d2d7c8c8cde4da9225c226ea882c8fd1343676a799799bcf4ee13a10"
        reference = "https://attack.mitre.org/software/S0266/"
        severity = "high"
        
    strings:
        // TrickBot often has these strings in its main module
        $str1 = "mcconf.dll" ascii wide
        $str2 = "TrickBot" ascii wide nocase
        $str3 = "<moduleconfig>" ascii wide
        $str4 = "<autostart>" ascii wide
        $str5 = "group_tag" ascii wide
        $str6 = "client_id" ascii wide
        
        // Specific code patterns
        $code1 = { 8A 11 41 84 D2 75 ?? 8D 0C 52 83 F9 04 7C ?? 8B C1 C1 E8 02 }
        $code2 = { 33 C0 85 F6 7E ?? 8B D8 83 C3 01 83 FB 09 7C ?? }
        
        // Configuration related
        $config1 = "<servs>" ascii wide
        $config2 = "<srv>" ascii wide
        $config3 = "</srv>" ascii wide
        $config4 = "<plugins>" ascii wide
        
    condition:
        // Look for PE file with at least 4 of the strings OR both code patterns
        uint16(0) == 0x5A4D and 
        (
            (4 of ($str*) and 2 of ($config*)) or
            all of ($code*)
        )
}